<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>كفتة إزمير: وصفة تفاعلية متقدمة</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Tajawal', 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-50 */
            color: #334155; /* slate-700 */
        }
        .container {
            @apply max-w-5xl mx-auto px-4 py-8; /* Increased max-width for longer tables */
        }
        .section-title {
            @apply text-3xl font-bold text-indigo-700 mb-6 text-center; /* Changed color for distinction */
        }
        .card {
            @apply bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-300 ease-in-out;
        }
        table {
            @apply w-full text-sm text-right text-slate-700 rounded-lg overflow-hidden;
        }
        th, td {
            @apply px-4 py-3 border border-slate-200;
        }
        thead th {
            @apply bg-slate-100 text-slate-800 font-semibold;
        }
        tbody tr:nth-child(even) {
            @apply bg-slate-50;
        }
        tbody tr:hover {
            @apply bg-indigo-50;
        }
        input[type="number"] {
            @apply w-24 p-1 border border-slate-300 rounded-md text-center bg-slate-50 focus:border-indigo-500 focus:ring-indigo-500;
        }
        select {
            @apply p-1 border border-slate-300 rounded-md bg-slate-50 focus:border-indigo-500 focus:ring-indigo-500;
        }
        .rtl-text {
            direction: rtl;
            text-align: right;
        }
    </style>
</head>
<body class="rtl-text">

    <div class="container">
        <header class="text-center mb-10">
            <h1 class="text-4xl font-bold text-indigo-700 mb-2">كفتة إزمير: وصفة تفاعلية متقدمة</h1>
            <h2 class="text-2xl font-semibold text-slate-600">Izmir Kofta: An Advanced Interactive Recipe</h2>
            <p class="text-lg text-slate-500 mt-4">
                نقدم لكم وصفة كفتة إزمير الشهية بتصميم متطور وديناميكي. يمكنكم الآن تعديل الكميات، استكشاف بدائل المكونات، وحساب التكاليف وهوامش الربح بشكل فوري لتخطيط وجباتكم ومشاريعكم الغذائية بكفاءة عالية.
                <br>
                Introducing the delicious Izmir Kofta recipe with an advanced and dynamic design. You can now adjust quantities, explore ingredient alternatives, and instantly calculate costs and profit margins to plan your meals and food projects with high efficiency.
            </p>
        </header>

        <section id="recipe-overview" class="mb-10">
            <h2 class="section-title">نظرة عامة على الوصفة | Recipe Overview</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="card text-center">
                    <h3 class="text-lg font-medium text-slate-500 mb-2">وقت التحضير</h3>
                    <p class="text-2xl font-bold text-indigo-600">60 دقيقة</p>
                    <p class="text-sm text-slate-500">Preparation Time</p>
                </div>
                <div class="card text-center">
                    <h3 class="text-lg font-medium text-slate-500 mb-2">وقت الطهي</h3>
                    <p class="text-2xl font-bold text-indigo-600">1 ساعة و 30 دقيقة</p>
                    <p class="text-sm text-slate-500">Cooking Time</p>
                </div>
                <div class="card text-center">
                    <h3 class="text-lg font-medium text-slate-500 mb-2">الكمية الأصلية</h3>
                    <p class="text-2xl font-bold text-indigo-600">سخان واحد (12 شخص)</p>
                    <p class="text-sm text-slate-500">1 Hot Pot (Serves 12 people)</p>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                <div class="card text-center">
                    <h3 class="text-lg font-medium text-slate-500 mb-2">التكلفة لكل حصة (تقديري)</h3>
                    <p class="text-2xl font-bold text-indigo-600" id="costPerServingDisplay">0.00 ريال</p>
                    <p class="text-sm text-slate-500">Estimated Cost per Serving</p>
                </div>
                <div class="card text-center">
                    <h3 class="text-lg font-medium text-slate-500 mb-2">سعر البيع المقترح للحصة</h3>
                    <p class="text-2xl font-bold text-indigo-600" id="suggestedSellingPriceDisplay">0.00 ريال</p>
                    <p class="text-sm text-slate-500">Suggested Selling Price per Serving</p>
                </div>
            </div>
        </section>

        <section id="ingredients" class="mb-10">
            <h2 class="section-title">المكونات | Ingredients</h2>
            <div class="overflow-x-auto card">
                <h3 class="text-xl font-semibold text-indigo-600 mb-3">1. مكونات الكفتة:</h3>
                <table id="ingredientsTableKofta" class="mb-6">
                    <thead>
                        <tr>
                            <th>م</th>
                            <th>المكون<br>Ingredient</th>
                            <th>الوحدة<br>Unit</th>
                            <th>الكمية<br>Quantity</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>1</td><td>لحم غنم مع الليه<br>Lamb Meat with Fat</td><td>كجم (kg)</td><td>2</td></tr>
                        <tr><td>2</td><td>فلفل أخضر<br>Green Pepper</td><td>غرام (g)</td><td>50</td></tr>
                        <tr><td>3</td><td>فلفل أحمر<br>Red Pepper</td><td>غرام (g)</td><td>50</td></tr>
                        <tr><td>4</td><td>بصل مقشر<br>Peeled Onion</td><td>غرام (g)</td><td>50</td></tr>
                        <tr><td>5</td><td>ثوم حب<br>Garlic Cloves</td><td>غرام (g)</td><td>30</td></tr>
                        <tr><td>6</td><td>نعناع أخضر<br>Fresh Mint</td><td>غرام (g)</td><td>30</td></tr>
                        <tr><td>7</td><td>فلفل أبيض<br>White Pepper</td><td>غرام (g)</td><td>10</td></tr>
                        <tr><td>8</td><td>فلفل أسود<br>Black Pepper</td><td>غرام (g)</td><td>10</td></tr>
                        <tr><td>9</td><td>كعك مطحون<br>Ground Rusk/Breadcrumbs</td><td>غرام (g)</td><td>100</td></tr>
                        <tr><td>10</td><td>ملح طعام<br>Salt</td><td>غرام (g)</td><td>40</td></tr>
                        <tr><td>11</td><td>بابريكا<br>Paprika</td><td>غرام (g)</td><td>20</td></tr>
                    </tbody>
                </table>

                <h3 class="text-xl font-semibold text-indigo-600 mb-3 mt-6">2. مكونات الصلصة:</h3>
                <table id="ingredientsTableSauce" class="mb-6">
                    <thead>
                        <tr>
                            <th>م</th>
                            <th>المكون<br>Ingredient</th>
                            <th>الوحدة<br>Unit</th>
                            <th>الكمية<br>Quantity</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>1</td><td>بصل ناعم<br>Minced Onion</td><td>غرام (g)</td><td>50</td></tr>
                        <tr><td>2</td><td>ثوم ناعم<br>Minced Garlic</td><td>غرام (g)</td><td>50</td></tr>
                        <tr><td>3</td><td>فلفل أخضر وأحمر ناعم<br>Minced Green & Red Pepper</td><td>غرام (g)</td><td>50</td></tr>
                        <tr><td>4</td><td>طماطم ناعم<br>Minced Tomatoes</td><td>غرام (g)</td><td>150</td></tr>
                        <tr><td>5</td><td>كزبرة ناعم<br>Minced Coriander</td><td>غرام (g)</td><td>30</td></tr>
                        <tr><td>6</td><td>كمون ناعم<br>Ground Cumin</td><td>غرام (g)</td><td>20</td></tr>
                        <tr><td>7</td><td>فلفل أبيض ناعم<br>Fine White Pepper</td><td>غرام (g)</td><td>20</td></tr>
                        <tr><td>8</td><td>نعناع ناشف<br>Dried Mint</td><td>غرام (g)</td><td>20</td></tr>
                        <tr><td>9</td><td>صلصة طماطم<br>Tomato Paste</td><td>غرام (g)</td><td>100</td></tr>
                        <tr><td>10</td><td>مكعبات ماجي<br>Maggi Cubes</td><td>مكعب (cube)</td><td>4</td></tr>
                        <tr><td>11</td><td>بابريكا حار<br>Hot Paprika</td><td>غرام (g)</td><td>20</td></tr>
                        <tr><td>12</td><td>سمنة<br>Ghee</td><td>غرام (g)</td><td>30</td></tr>
                        <tr><td>13</td><td>ملح<br>Salt</td><td>غرام (g)</td><td>حسب الرغبة (تقديري 15غ)<br>To taste (est. 15g)</td></tr>
                    </tbody>
                </table>

                <h3 class="text-xl font-semibold text-indigo-600 mb-3 mt-6">3. مكونات إضافية (للطبقات والتزيين):</h3>
                <table id="ingredientsTableOther">
                    <thead>
                        <tr>
                            <th>م</th>
                            <th>المكون<br>Ingredient</th>
                            <th>الوحدة<br>Unit</th>
                            <th>الكمية<br>Quantity</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>1</td><td>بطاط مقشرة<br>Peeled Potatoes</td><td>كجم (kg)</td><td>2</td></tr>
                        <tr><td>2</td><td>طماطم مقشر<br>Peeled Tomatoes</td><td>كجم (kg)</td><td>1</td></tr>
                        <tr><td>3</td><td>فلفل أخضر وسط<br>Medium Green Pepper</td><td>غرام (g)</td><td>250</td></tr>
                        <tr><td>4</td><td>أوراق نعناع أخضر<br>Fresh Mint Leaves</td><td>غرام (g)</td><td>30</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <section id="preparation-steps" class="mb-10">
            <h2 class="section-title">طريقة التحضير | Preparation Steps</h2>
            <div class="card space-y-4">
                <p class="text-lg font-semibold text-indigo-600">1. تحضير الكفتة | Preparing the Kofta:</p>
                <p>نخلط اللحم مع جميع مكونات الكفتة الخاصة بها (فلفل أخضر وأحمر، بصل، ثوم، نعناع أخضر، البهارات، الكعك، الملح، البابريكا). نفرم الخليط بشكل ناعم ثم ندعكه جيداً. نشكل الكفتة على شكل أقراص متساوية ونرصها في صينية خاصة. ندخلها إلى فرن مسخن مسبقاً على حرارة 200 درجة مئوية لمدة 15 دقيقة حتى تتماسك وتأخذ لوناً خفيفاً.</p>
                
                <p class="text-lg font-semibold text-indigo-600 mt-4">2. تحضير الصلصة | Preparing the Sauce:</p>
                <p>في وعاء طهي على النار، نضع السمنة حتى تسخن. نضيف البصل الناعم والثوم الناعم ونحرك لمدة 5 دقائق حتى يذبلا. نضيف الطماطم المفرومة ناعماً ونقلب. ثم نضيف البهارات الخاصة بالصلصة (كمون، فلفل أبيض، نعناع ناشف، بابريكا حار) وصلصة الطماطم. نحرك المكونات معاً لمدة 5 دقائق. نضيف كمية مناسبة من الماء، مكعبات الماجي، والملح حسب الرغبة. ندع الصلصة تغلي جيداً وتتكثف قليلاً.</p>

                <p class="text-lg font-semibold text-indigo-600 mt-4">3. تحضير الخضروات الإضافية | Preparing Additional Vegetables:</p>
                <p>نقطع البطاطس المقشرة إلى شرائح بسماكة نصف سنتيمتر تقريباً. نقلي شرائح البطاطس في زيت غزير حار لمدة 5 دقائق حتى تصبح ذهبية قليلاً (نصف قلية). نرفعها من الزيت وندعها في مصفاة للتخلص من الزيت الزائد. نقطع الطماطم المقشرة إلى شرائح. نغسل حبات الفلفل الأخضر الوسط وننزع الجزء السفلي (العنقود) منها، مع الحفاظ عليها كاملة.</p>

                <p class="text-lg font-semibold text-indigo-600 mt-4">4. تجميع السخان والطهي النهائي | Assembling the Hot Pot & Final Cooking:</p>
                <p>في سخان التقديم (أو صينية فرن عميقة)، نرتب نصف كمية شرائح البطاطس المقلية كطبقة أولى. فوقها، نرص أقراص الكفتة المخبوزة مسبقاً. نوزع أوراق النعناع الأخضر الطازج فوق الكفتة. ثم نضع النصف الثاني من شرائح البطاطس كطبقة علوية. نسكب الصلصة المحضرة فوق طبقات البطاطس والكفتة حتى تُغمر جيداً. نغطي سطح السخان بشرائح الطماطم وحبات الفلفل الأخضر الكاملة. يمكن إضافة كمية أخرى من الصلصة إذا لزم الأمر لتغطية المكونات. نغطي السخان وندخله إلى فرن مسخن مسبقاً على حرارة 250 درجة مئوية لمدة ساعة واحدة، أو حتى تنضج جميع المكونات وتتسبك الصلصة.</p>

                <p class="text-lg font-semibold text-indigo-600 mt-4">5. التقديم | Serving:</p>
                <p>نخرج السخان من الفرن ونتأكد من استواء الكفتة والخضروات. يُقدم طبق كفتة إزمير ساخناً، ويُفضل تقديمه مع الأرز الأبيض بالشعيرية أو الخبز العربي.</p>
            </div>
        </section>

        <section id="chef-tips" class="mb-10">
            <h2 class="section-title">نصائح الشيف الخاصة | Special Chef Tips</h2>
            <div class="card space-y-3 p-6 bg-indigo-50 border-r-4 border-indigo-600">
                <p class="text-slate-700">**للحصول على كفتة طرية:** لا تبالغ في دعك اللحم بعد الفرم، فقط لضمان تماسك المكونات. الفرم المزدوج يساعد على نعومة الكفتة.</p>
                <p class="text-slate-700">**نكهة مدخنة (اختياري):** بعد خبز الكفتة، يمكن وضع قطعة فحم مشتعلة في طبق صغير مقاوم للحرارة مع قليل من الزيت داخل صينية الكفتة وتغطيتها لبضع دقائق لإضفاء نكهة مدخنة خفيفة.</p>
                <p class="text-slate-700">**قوام الصلصة:** يمكن التحكم في كثافة الصلصة عن طريق تعديل كمية الماء أو مدة الغليان. يجب أن تكون الصلصة غنية وكافية لتغطية المكونات.</p>
                <p class="text-slate-700">**جودة اللحم:** استخدام لحم غنم طازج مع نسبة دهون مناسبة (حوالي 20%) يعطي أفضل نتيجة من حيث الطعم والقوام.</p>
                <p class="text-slate-700">**البطاطس:** قلي البطاطس نصف قلية قبل إضافتها للسخان يضمن عدم تفتتها أثناء الطهي الطويل ويمنحها قواماً أفضل.</p>
            </div>
        </section>

        <section id="nutritional-analysis" class="mb-10">
            <h2 class="section-title">التحليل الغذائي | Nutritional Analysis</h2>
            <p class="text-center text-slate-600 mb-4">
                (تقريبي لكل حصة - بافتراض 12 حصة لكل سخان) | (Approximate per Serving - assuming 12 servings per hot pot)
            </p>
            <div class="overflow-x-auto card">
                <table>
                    <thead>
                        <tr>
                            <th>المغذّي<br>Nutrient</th>
                            <th>القيمة لكل حصة<br>Value per Serving</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>السعرات الحرارية<br>Calories</td><td>450 - 600 سعرة حرارية / kcal</td></tr>
                        <tr><td>البروتين<br>Protein</td><td>30 - 40 غرام / g</td></tr>
                        <tr><td>الدهون الكلية<br>Total Fat</td><td>25 - 35 غرام / g</td></tr>
                        <tr><td>الدهون المشبعة<br>Saturated Fat</td><td>10 - 15 غرام / g</td></tr>
                        <tr><td>الكربوهيدرات<br>Carbohydrates</td><td>20 - 30 غرام / g</td></tr>
                        <tr><td>الألياف الغذائية<br>Dietary Fiber</td><td>4 - 7 غرام / g</td></tr>
                        <tr><td>السكريات<br>Sugars</td><td>5 - 8 غرام / g</td></tr>
                        <tr><td>الصوديوم<br>Sodium</td><td>700 - 1000 ملغ / mg (يعتمد على كمية الملح المضافة)</td></tr>
                    </tbody>
                </table>
            </div>
            <p class="text-center text-sm text-slate-500 mt-4">
                **ملاحظة هامة:** هذه القيم تقديرية وتعتمد على دقة المكونات ونسبة الدهون في اللحم وطريقة التحضير. للحصول على تحليل دقيق، يفضل استخدام برامج تحليل غذائي متخصصة.
            </p>
        </section>

        <section id="cost-analysis" class="mb-10">
            <h2 class="section-title">تحليل التكلفة الحية | Live Cost Analysis</h2>
            <p class="text-center text-slate-600 mb-4">
                (لكل صنف ولكل سخان - نموذج عملي) | (Per Item & Per Hot Pot - Practical Model)
            </p>
            <p class="text-center text-sm text-slate-500 mb-6">
                الأسعار المذكورة أدناه هي تقديرية بناءً على متوسط أسعار السوق في الرياض.
                **يمكنك تغيير هذه الأسعار في حقول الإدخال** لتعكس تكاليف الشراء الحالية لديك والحصول على حسابات دقيقة.
            </p>
            <div class="card p-6 mb-4">
                <div class="flex flex-col sm:flex-row items-center justify-center gap-4 mb-4">
                    <label for="numServings" class="text-lg font-medium text-slate-700 whitespace-nowrap">
                        عدد الأشخاص:
                        <br>
                        Number of Servings:
                    </label>
                    <input type="number" id="numServings" value="12" min="1" step="1" class="w-32 p-2 border border-slate-300 rounded-md text-center bg-slate-50 focus:border-indigo-500 focus:ring-indigo-500 text-xl font-bold">
                </div>
                <div class="flex flex-col sm:flex-row items-center justify-center gap-4 mb-4">
                    <label for="profitMargin" class="text-lg font-medium text-slate-700 whitespace-nowrap">
                        هامش الربح المطلوب (%):
                        <br>
                        Desired Profit Margin (%):
                    </label>
                    <input type="number" id="profitMargin" value="30" min="0" step="1" class="w-32 p-2 border border-slate-300 rounded-md text-center bg-slate-50 focus:border-indigo-500 focus:ring-indigo-500 text-xl font-bold">
                </div>
                <div class="flex flex-col sm:flex-row items-center justify-center gap-4">
                    <label for="meatSubstitution" class="text-lg font-medium text-slate-700 whitespace-nowrap">
                        استبدال لحم الكفتة:
                        <br>
                        Kofta Meat Substitution:
                    </label>
                    <select id="meatSubstitution" class="p-2 border border-slate-300 rounded-md bg-slate-50 focus:border-indigo-500 focus:ring-indigo-500">
                        <option value="lamb_kofta">كفتة لحم غنم (الأصلي)</option>
                        <option value="beef_kofta">كفتة لحم بقر (تقديري: -15% تكلفة)</option>
                    </select>
                </div>
            </div>

            <div class="overflow-x-auto card">
                <table id="costAnalysisTable">
                    <thead>
                        <tr>
                            <th>م</th>
                            <th>المكون<br>Ingredient</th>
                            <th>الكمية الأصلية<br>Original Quantity</th>
                            <th>الكمية المعدلة<br>Adjusted Quantity</th>
                            <th>سعر الوحدة التقريبي (ريال سعودي)<br>Approx. Unit Price (SAR)</th>
                            <th>التكلفة لكل صنف (ريال سعودي)<br>Cost per Item (SAR)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Rows will be populated by JavaScript -->
                    </tbody>
                    <tfoot>
                        <tr class="font-bold bg-slate-200">
                            <td colspan="5" class="text-left">التكلفة الإجمالية للمكونات لكل سخان:<br>Total Ingredient Cost per Hot Pot:</td>
                            <td id="totalCost" class="text-center">0.00 ريال</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </section>

        <section id="scientific-cost-solutions" class="mb-10">
            <h2 class="section-title">حلول علمية لتقليل التكلفة | Scientific Solutions for Cost Reduction</h2>
            <div class="card space-y-4 p-6 bg-blue-50 border-r-4 border-blue-600">
                <p class="text-slate-700 text-lg font-semibold">
                    لتحقيق أقصى قدر من الكفاءة والربحية، يتطلب تقليل التكلفة نهجاً منهجياً يعتمد على البيانات. إليك حلول علمية قابلة للتطبيق:
                </p>
                <ul class="list-disc list-inside space-y-2 text-slate-700">
                    <li><span class="font-semibold">تحسين عملية الشراء:</span> الشراء بكميات كبيرة، تفاوض الموردين، الشراء الموسمي.</li>
                    <li><span class="font-semibold">إدارة الهدر والفاقد:</span> التحكم في الحصص، تتبع الهدر، إعادة تدوير المكونات.</li>
                    <li><span class="font-semibold">توحيد الوصفات والإنتاج:</span> بطاقات وصفات قياسية، تحسين سير العمل.</li>
                    <li><span class="font-semibold">كفاءة الطاقة والعمالة:</span> مراقبة استهلاك الطاقة، جدولة العمالة الفعالة.</li>
                    <li><span class="font-semibold">هندسة القائمة:</span> تحليل ربحية الطبق والترويج للأطباق ذات الهامش العالي.</li>
                </ul>
            </div>
        </section>

        <section id="serving-suggestions" class="mb-10">
            <h2 class="section-title">اقتراحات التقديم | Serving Suggestions</h2>
            <div class="card text-center text-lg text-slate-700">
                <p>يُقدم طبق كفتة إزمير ساخناً، ويُعتبر مثالياً مع:</p>
                <ul class="list-disc list-inside mx-auto w-fit mt-2">
                    <li>الأرز الأبيض بالشعيرية أو الأرز البسمتي السادة.</li>
                    <li>الخبز العربي الطازج أو خبز البيتا.</li>
                    <li>طبق جانبي من سلطة الزبادي بالخيار أو سلطة خضراء.</li>
                </ul>
                <p class="mt-4">Serve Izmir Kofta hot. It pairs perfectly with:</p>
                <ul class="list-disc list-inside mx-auto w-fit mt-2">
                    <li>Vermicelli white rice or plain Basmati rice.</li>
                    <li>Fresh Arabic bread or pita bread.</li>
                    <li>A side dish of cucumber yogurt salad or a fresh green salad.</li>
                </ul>
            </div>
        </section>

        <footer class="mt-12 text-center text-sm text-slate-500">
            <p>&copy; <span id="currentYear"></span> جميع الحقوق محفوظة. تم التصميم بواسطة خبير شيمي شامي.</p>
            <p>&copy; <span id="currentYearEnglish"></span> All rights reserved. Designed by Shami Shami Expert.</p>
        </footer>
    </div>

    <script>
        const originalServings = 12; // The original recipe yield for 1 hot pot
        let currentServings = originalServings; // Initial serving count

        const ingredientsData = [
            // Kofta Ingredients
            { id: 'lambForKofta', name: { ar: "لحم غنم مع الليه (للكفتة)", en: "Lamb Meat with Fat (for Kofta)" }, originalQuantity: 2, unit: { ar: "كجم", en: "kg" }, estimatedPrice: 70.00 },
            { id: 'greenPepperKofta', name: { ar: "فلفل أخضر (للكفتة)", en: "Green Pepper (for Kofta)" }, originalQuantity: 50, unit: { ar: "غرام", en: "g" }, estimatedPrice: 0.008 },
            { id: 'redPepperKofta', name: { ar: "فلفل أحمر (للكفتة)", en: "Red Pepper (for Kofta)" }, originalQuantity: 50, unit: { ar: "غرام", en: "g" }, estimatedPrice: 0.010 },
            { id: 'onionKofta', name: { ar: "بصل مقشر (للكفتة)", en: "Peeled Onion (for Kofta)" }, originalQuantity: 50, unit: { ar: "غرام", en: "g" }, estimatedPrice: 0.003 },
            { id: 'garlicKofta', name: { ar: "ثوم حب (للكفتة)", en: "Garlic Cloves (for Kofta)" }, originalQuantity: 30, unit: { ar: "غرام", en: "g" }, estimatedPrice: 0.015 },
            { id: 'mintKofta', name: { ar: "نعناع أخضر (للكفتة)", en: "Fresh Mint (for Kofta)" }, originalQuantity: 30, unit: { ar: "غرام", en: "g" }, estimatedPrice: 0.05 },
            { id: 'whitePepperKofta', name: { ar: "فلفل أبيض (للكفتة)", en: "White Pepper (for Kofta)" }, originalQuantity: 10, unit: { ar: "غرام", en: "g" }, estimatedPrice: 0.20 },
            { id: 'blackPepperKofta', name: { ar: "فلفل أسود (للكفتة)", en: "Black Pepper (for Kofta)" }, originalQuantity: 10, unit: { ar: "غرام", en: "g" }, estimatedPrice: 0.15 },
            { id: 'breadcrumbsKofta', name: { ar: "كعك مطحون (للكفتة)", en: "Ground Rusk/Breadcrumbs (for Kofta)" }, originalQuantity: 100, unit: { ar: "غرام", en: "g" }, estimatedPrice: 0.02 },
            { id: 'saltKofta', name: { ar: "ملح طعام (للكفتة)", en: "Salt (for Kofta)" }, originalQuantity: 40, unit: { ar: "غرام", en: "g" }, estimatedPrice: 0.002 },
            { id: 'paprikaKofta', name: { ar: "بابريكا (للكفتة)", en: "Paprika (for Kofta)" }, originalQuantity: 20, unit: { ar: "غرام", en: "g" }, estimatedPrice: 0.10 },

            // Sauce Ingredients
            { id: 'onionSauce', name: { ar: "بصل ناعم (للصلصة)", en: "Minced Onion (for Sauce)" }, originalQuantity: 50, unit: { ar: "غرام", en: "g" }, estimatedPrice: 0.003 },
            { id: 'garlicSauce', name: { ar: "ثوم ناعم (للصلصة)", en: "Minced Garlic (for Sauce)" }, originalQuantity: 50, unit: { ar: "غرام", en: "g" }, estimatedPrice: 0.015 },
            { id: 'mixedPepperSauce', name: { ar: "فلفل أخضر وأحمر ناعم (للصلصة)", en: "Minced Green & Red Pepper (for Sauce)" }, originalQuantity: 50, unit: { ar: "غرام", en: "g" }, estimatedPrice: 0.009 },
            { id: 'tomatoesSauce', name: { ar: "طماطم ناعم (للصلصة)", en: "Minced Tomatoes (for Sauce)" }, originalQuantity: 150, unit: { ar: "غرام", en: "g" }, estimatedPrice: 0.006 },
            { id: 'corianderSauce', name: { ar: "كزبرة ناعم (للصلصة)", en: "Minced Coriander (for Sauce)" }, originalQuantity: 30, unit: { ar: "غرام", en: "g" }, estimatedPrice: 0.05 },
            { id: 'cuminSauce', name: { ar: "كمون ناعم (للصلصة)", en: "Ground Cumin (for Sauce)" }, originalQuantity: 20, unit: { ar: "غرام", en: "g" }, estimatedPrice: 0.18 },
            { id: 'whitePepperSauce', name: { ar: "فلفل أبيض ناعم (للصلصة)", en: "Fine White Pepper (for Sauce)" }, originalQuantity: 20, unit: { ar: "غرام", en: "g" }, estimatedPrice: 0.20 },
            { id: 'driedMintSauce', name: { ar: "نعناع ناشف (للصلصة)", en: "Dried Mint (for Sauce)" }, originalQuantity: 20, unit: { ar: "غرام", en: "g" }, estimatedPrice: 0.10 },
            { id: 'tomatoPasteSauce', name: { ar: "صلصة طماطم (للصلصة)", en: "Tomato Paste (for Sauce)" }, originalQuantity: 100, unit: { ar: "غرام", en: "g" }, estimatedPrice: 0.03 },
            { id: 'maggiCubesSauce', name: { ar: "مكعبات ماجي (للصلصة)", en: "Maggi Cubes (for Sauce)" }, originalQuantity: 4, unit: { ar: "مكعب", en: "cube" }, estimatedPrice: 0.75 }, // Price per cube
            { id: 'hotPaprikaSauce', name: { ar: "بابريكا حار (للصلصة)", en: "Hot Paprika (for Sauce)" }, originalQuantity: 20, unit: { ar: "غرام", en: "g" }, estimatedPrice: 0.12 },
            { id: 'gheeSauce', name: { ar: "سمنة (للصلصة)", en: "Ghee (for Sauce)" }, originalQuantity: 30, unit: { ar: "غرام", en: "g" }, estimatedPrice: 0.06 },
            { id: 'saltSauce', name: { ar: "ملح (للصلصة)", en: "Salt (for Sauce)" }, originalQuantity: 15, unit: { ar: "غرام", en: "g" }, estimatedPrice: 0.002 },

            // Other Ingredients (Layering/Garnish)
            { id: 'potatoesLayer', name: { ar: "بطاط مقشرة (للطبقات)", en: "Peeled Potatoes (for layering)" }, originalQuantity: 2, unit: { ar: "كجم", en: "kg" }, estimatedPrice: 3.50 },
            { id: 'tomatoesLayer', name: { ar: "طماطم مقشر (للطبقات)", en: "Peeled Tomatoes (for layering)" }, originalQuantity: 1, unit: { ar: "كجم", en: "kg" }, estimatedPrice: 6.00 },
            { id: 'greenPepperLayer', name: { ar: "فلفل أخضر وسط (للطبقات)", en: "Medium Green Pepper (for layering)" }, originalQuantity: 250, unit: { ar: "غرام", en: "g" }, estimatedPrice: 0.008 },
            { id: 'freshMintLeavesLayer', name: { ar: "أوراق نعناع أخضر (للطبقات)", en: "Fresh Mint Leaves (for layering)" }, originalQuantity: 30, unit: { ar: "غرام", en: "g" }, estimatedPrice: 0.05 }
        ];

        const costAnalysisTableBody = document.getElementById('costAnalysisTable').getElementsByTagName('tbody')[0];
        const totalCostElement = document.getElementById('totalCost');
        const numServingsInput = document.getElementById('numServings');
        const profitMarginInput = document.getElementById('profitMargin');
        const meatSubstitutionSelect = document.getElementById('meatSubstitution');
        const costPerServingDisplay = document.getElementById('costPerServingDisplay');
        const suggestedSellingPriceDisplay = document.getElementById('suggestedSellingPriceDisplay');

        function calculateTotalCost() {
            let total = 0;
            const rows = costAnalysisTableBody.rows;
            const multiplier = currentServings / originalServings;

            ingredientsData.forEach((item, index) => {
                const row = rows[index];
                const adjustedQuantity = item.originalQuantity * multiplier;
                // Update adjusted quantity display in the table
                row.cells[3].innerHTML = `${adjustedQuantity.toFixed(2)} ${item.unit.ar}<br>${adjustedQuantity.toFixed(2)} ${item.unit.en}`;

                const unitPriceInput = row.cells[4].querySelector('input');
                let currentEstimatedPrice = item.estimatedPrice; // Original estimated price per unit

                // Apply substitution price for kofta meat
                if (item.id === 'lambForKofta') {
                    if (meatSubstitutionSelect.value === 'beef_kofta') {
                        currentEstimatedPrice = item.estimatedPrice * 0.85; // Beef is 15% cheaper
                    } else { // lamb_kofta
                        currentEstimatedPrice = item.estimatedPrice; // Original lamb price
                    }
                    // Update the input field to reflect the potentially changed price per unit
                    // The toFixed precision depends on the unit (kg, g, cube)
                    let precision = 4; // Default for grams
                    if (item.unit.en === 'kg' || item.unit.en === 'cube') {
                        precision = 2;
                    }
                    unitPriceInput.value = currentEstimatedPrice.toFixed(precision);
                }
                
                let unitPrice = parseFloat(unitPriceInput.value);
                if (isNaN(unitPrice)) unitPrice = 0;


                const costPerItem = adjustedQuantity * unitPrice;
                // item.costPerItem = costPerItem; // Not strictly needed to store on item if only used here
                row.cells[5].textContent = costPerItem.toFixed(2) + ' ريال';
                total += costPerItem;
            });

            totalCostElement.textContent = total.toFixed(2) + ' ريال';

            const costPerServing = (currentServings > 0) ? (total / currentServings) : 0;
            costPerServingDisplay.textContent = `${costPerServing.toFixed(2)} ريال`;

            const profitMargin = parseFloat(profitMarginInput.value) / 100;
            let suggestedSellingPrice = 0;
            if (profitMargin >= 0 && profitMargin < 1 && costPerServing > 0) { // Ensure profit margin is valid
                suggestedSellingPrice = costPerServing / (1 - profitMargin);
            } else if (costPerServing > 0) {
                suggestedSellingPrice = costPerServing; // If profit margin is invalid or 0, selling price is cost price
            }
            suggestedSellingPriceDisplay.textContent = `${suggestedSellingPrice.toFixed(2)} ريال`;
        }

        // Populate the cost analysis table
        ingredientsData.forEach((item, index) => {
            let row = costAnalysisTableBody.insertRow();
            row.insertCell().textContent = index + 1; // Serial number
            row.insertCell().innerHTML = `${item.name.ar}<br>${item.name.en}`; // Ingredient name
            row.insertCell().innerHTML = `${item.originalQuantity} ${item.unit.ar}<br>${item.originalQuantity} ${item.unit.en}`; // Original quantity
            
            // Adjusted quantity cell (will be updated by calculateTotalCost)
            let adjustedQuantityCell = row.insertCell();
            adjustedQuantityCell.innerHTML = `${item.originalQuantity.toFixed(2)} ${item.unit.ar}<br>${item.originalQuantity.toFixed(2)} ${item.unit.en}`;
            
            // Unit price input cell
            let priceCell = row.insertCell();
            let priceInput = document.createElement('input');
            priceInput.type = 'number';
            
            let precision = 4; // Default for grams
            if (item.unit.en === 'kg' || item.unit.en === 'cube') {
                precision = 2;
            }
            priceInput.value = item.estimatedPrice.toFixed(precision);
            priceInput.step = '0.0001'; // Allow fine adjustments
            priceInput.classList.add('text-center');
            priceInput.oninput = calculateTotalCost;
            priceCell.appendChild(priceInput);

            // Cost per item cell (will be updated by calculateTotalCost)
            let costPerItemCell = row.insertCell();
            costPerItemCell.textContent = '0.00 ريال'; 
        });

        // Event listeners
        numServingsInput.addEventListener('input', (event) => {
            currentServings = parseFloat(event.target.value);
            if (isNaN(currentServings) || currentServings < 1) {
                currentServings = 1; // Default to 1 if input is invalid
                numServingsInput.value = 1;
            }
            calculateTotalCost();
        });

        profitMarginInput.addEventListener('input', calculateTotalCost);
        meatSubstitutionSelect.addEventListener('change', calculateTotalCost);

        // Initial calculation on page load
        calculateTotalCost();

        // Set current year in footer
        document.getElementById('currentYear').textContent = new Date().getFullYear();
        document.getElementById('currentYearEnglish').textContent = new Date().getFullYear();
    </script>

</body>
</html>
